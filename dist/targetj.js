(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{$Dom:()=>s,App:()=>v,EasingEffects:()=>r,SearchUtil:()=>o,TModel:()=>h,TUtil:()=>a,getEvents:()=>T,getLoader:()=>C,getPager:()=>V,getScreenHeight:()=>L,getScreenWidth:()=>M,tapp:()=>i});var i,n={style:void 0,delayProcess:{},setup:function(){if("function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){return 0===this.indexOf(t)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),"function"!=typeof String.prototype.hashCode&&(String.prototype.hashCode=function(){var t,e,i=0;if(0===this.length)return i;for(t=0,e=this.length;t<e;t++)i=(i<<5)-i+this.charCodeAt(t),i|=0;return Math.abs(i)}),Array.prototype.oids||(Array.prototype.oids=function(t){return this.map((function(t){return t.oid})).join(t||" ")}),Array.spaces||(Array.spaces=function(t){return Array(t).join(" ")}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null===this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],a=0;a<i;){var r=e[a];if(t.call(n,r,a,e))return r;a++}},configurable:!0,writable:!0}),!document.getElementsByClassName){var t=[].indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1},e=function(e,i){return document.querySelectorAll?i.querySelectorAll("."+e):function(){for(var n=i.getElementsByTagName("*"),a=[],r=0;r<n.length;r++)n[r].className&&(" "+n[r].className+" ").indexOf(" "+e+" ")>-1&&-1===t.call(a,n[r])&&a.push(n[r]);return a}()};document.getElementsByClassName=function(t){return e(t,document)},Element.prototype.getElementsByClassName=function(t){return e(t,this)}}for(var i=0,n=["ms","moz","webkit","o"],a=0;a<n.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[n[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[a]+"CancelAnimationFrame"]||window[n[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=(new Date).getTime(),a=Math.max(0,16-(n-i)),r=window.setTimeout((function(){t(n+a)}),a);return i=n+a,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),this.style={transform:this.prefixStyle("transform"),transitionTimingFunction:this.prefixStyle("transitionTimingFunction"),transitionDuration:this.prefixStyle("transitionDuration")}},log:function(t){return!0===t?console.log:function(){}},prefixStyle:function(t){for(var e=document.createElement("div").style,i="",n=["webkitT","MozT","msT","OT","t"],a=0;a<n.length;a++)n[a]+"ransform"in e&&(i=n[a].substr(0,n[a].length-1));return""===i?t:i+t.charAt(0).toUpperCase()+t.substr(1)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?0:decodeURIComponent(e[1].replace(/\+/g," "))},now:Date.now||function(){return(new Date).getTime()},nowInSeconds:function(){return Math.floor(this.now()/1e3)},delay:function(t,e,i){var a,r=n.now()+i;return this.delayProcess.id?r>=this.delayProcess.timeStamp?a={timeStamp:r,oid:e,delay:i}:r<this.delayProcess.timeStamp&&(a={timeStamp:this.delayProcess.timeStamp,oid:this.delayProcess.oid,delay:this.delayProcess.delay},clearTimeout(this.delayProcess.id),this.delayProcess.oid=e,this.delayProcess.timeStamp=r,this.delayProcess.delay=i,this.delayProcess.id=setTimeout((function(){t(),n.delayProcess={}}),i)):(this.delayProcess.oid=e,this.delayProcess.timeStamp=r,this.delayProcess.delay=i,this.delayProcess.id=setTimeout((function(){t(),n.delayProcess={}}),i)),a}};function a(){}function r(){}function s(t){"string"==typeof t?(this.selector=t,this.element=s.query(t)):t&&(this.element=t),this.childrenCount=0,this.$domParent=void 0,this.originalContent=void 0,this.textOnly=!0}function o(){}function l(){}function u(t){this.tmodel=t,this.xNext=0,this.xNorth=0,this.xWest=0,this.xEast=0,this.xSouth=0,this.xOverflow=0,this.xOffset=0,this.yNext=0,this.yNorth=0,this.yWest=0,this.yEast=0,this.ySouth=0,this.yOffset=0,this.reset()}function h(t,e){1===arguments.length&&"object"==typeof t&&(e=t,t=""),this.type=t||"blank",this.targets=Object.assign({},e);var i=v.getOid(this.type);this.oid=i.oid,this.oidNum=i.num,this.targetValues={},this.actualValues={x:0,y:0,width:0,height:0,leftMargin:0,rightMargin:0,topMargin:0,bottomMargin:0,opacity:1,zIndex:1,scale:1,rotate:0,scrollLeft:0,scrollTop:0,textOnly:!0,html:void 0,css:"",style:null,children:[],addedChildren:[],allChildren:[],isInFlow:!0,canHaveDom:!0,canHandleEvents:!1,isOverflowHidden:!1,canBeVisible:!0,canBeBracketed:!0,isDomDeletable:!0},this.activeTargetKeyMap={},this.targetUpdatingMap={},this.targetUpdatingList=[],this.updatingChildren=[],this.targetLastUpdateMap={},this.parent=null,this.$dom=null,this.yVisible=!1,this.xVisible=!1,this.domHeight=void 0,this.domWidth=void 0,this.innerContentWidth=0,this.innerContentHeight=0,this.contentWidth=0,this.contentHeight=0,this.x=0,this.y=0,this.absX=0,this.absY=0,this.deepY=0,this.deepX=0,this.inFlowVisibles=[],this.domValues={}}function c(){this.currentTouch={deltaY:0,deltaX:0,pinchDelta:0,key:"",manualMomentumFlag:!1,orientation:"none",dir:"",timeStamp:0},this.eventMap={mousedown:"touchstart",touchstart:"touchstart",mousemove:"touchmove",touchmove:"touchmove",touchend:"touchend",touchcancel:"touchend",pointerup:"touchend",MSPointerUp:"touchend",mouseup:"touchend",pointercancel:"touchend",MSPointerCancel:"touchend",mousecancel:"touchend",mouseleave:"touchleave",wheel:"wheel",DOMMouseScroll:"wheel",mousewheel:"wheel",keyup:"key",resize:"resize",orientationchange:"resize"},this.lastEvent=void 0,this.eventName="",this.eventTagName="",this.cursor={x:0,y:0},this.start0=void 0,this.start1=void 0,this.end0=void 0,this.end1=void 0,this.touchCount=0,this.currentEvent="",this.currentHandlers={touch:null,scrollLeft:null,scrollTop:null,pinch:null}}function d(){this.resultMap={},this.loadingMap={},this.singleLoadList=void 0,this.groupLoadList=void 0,this.imgLoadList=void 0,this.stopLoadingAfterAttempts=a.isDefined(i.stopLoadingAfterAttempts)?i.stopLoadingAfterAttempts:10,this.attemptFailedInterval=a.isDefined(i.attemptFailedInterval)?i.attemptFailedInterval:2e3,this.statistics={}}function g(t){var e=new h("BI");return e.parent=t,e.newFlag=!0,e.targets={canHaveDom:!1,innerXEast:{loop:!0,value:function(){return a.isDefined(e.getRealParent().getValue("innerXEast"))?e.getRealParent().getValue("innerXEast"):e.getRealParent().absX+e.getRealParent().getWidth()}},xOverflow:{loop:!0,value:function(){return this.getRealParent().getX()}},outerXEast:0},e.getTargetWidth=function(){return this.getContentWidth()},e.getTargetHeight=function(){return this.getContentHeight()},e.getWidth=function(){return this.getContentWidth()||1},e.getHeight=function(){return this.getContentHeight()||1},e.getInnerWidth=function(){return this.innerContentWidth},e.getInnerContentHeight=function(){return this.innerContentHeight},e.getScrollTop=function(){return this.initParents(),this.getRealParent().getScrollTop()},e.getScrollLeft=function(){return this.initParents(),this.getRealParent().getScrollLeft()},e.addUpdatingChild=function(t){this.getRealParent().addUpdatingChild(t)},e.createViewport=function(){return this.getRealParent().createViewport.call(this)},e.getRealParent=function(){return this.initParents(),this.realParent},e.shouldCalculateChildrenLocations=function(){var t=this.isVisible()||this.newFlag;return this.newFlag=!1,t},e.getChildren=function(){return this.actualValues.tchildren},e.addToParentVisibleList=function(){},e.initParents=function(){if(!this.realParent&&!this.topBracket){for(var t=this,e=this.bracketParent;e&&"BI"===e.type;)t=e,e=e.bracketParent;this.realParent=e,this.topBracket=t}},e.getChildrenOids=function(){for(var t=[],e=this.getChildren(),i=0;i<e.length;i++){var n=e[i];if("BI"===n.type){var a=n.getChildrenOids();t=[].concat(t,[n.oid],a)}else t.push(n.oid+":"+(n.location?n.y+"px":"0px"))}return t},e}function p(){this.hasLocationList=[],this.hasLocationMap={},this.bracketThreshold=4,this.locationCount=[]}function f(){this.lastLink=document.URL,this.pageCache={}}function m(){this.init()}function y(){this.doneTargets=[]}function v(t,e){return(i=function(t,e){function a(){}return a.throttle=0,a.debugLevel=0,a.runningFlag=!1,a.rootId=e||"#tpage",a.init=function(){return n.setup(),a.window=new s(window),a.window.addEvent("popstate",(function(t){t.state&&i.pager.openLinkFromHistory(t.state)})),a.loader=new d,a.pager=new f,a.dim=function(){function t(){}return t.screen={x:0,y:0,width:0,height:0},t.measureScreen=function(){return t.screen.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t.screen.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t},t}().measureScreen(),a.uiFactory=t instanceof h?function(){return new h(t.type,t.targets)}:t,a.ui=a.uiFactory(),a.ui.xVisible=!0,a.ui.yVisible=!0,a.events=new c,a.locationManager=new p,a.targetManager=new y,a.manager=new m,window.history.pushState({link:document.URL},"",document.URL),a},a.start=function(){return a.runningFlag=!1,s.query(a.rootId)?a.$dom=new s(a.rootId):(a.$dom=new s,a.$dom.create("div"),a.$dom.setSelector(a.rootId),a.$dom.setId(a.rootId),a.$dom.attr("tabindex","0"),new s("body").append$Dom(a.$dom)),a.events.removeHandlers(),a.events.clear(),a.events.addHandlers(),a.dim.measureScreen(),a.resetRuns(),a.runningFlag=!0,a.$dom.focus(),a.manager.scheduleRun(0,"appStart"),a},a.stop=function(){return a.runningFlag=!1,a.events.removeHandlers(),a.events.clear(),a.resetRuns(),a},a.resetRuns=function(){a.manager.nextRuns=[],a.manager.runningStep=0,a.manager.runningFlag=!1},a.reset=function(){a.manager.lists.visible.forEach((function(t){t.domValues={}})),a.manager.lists.visible.length=0,a.manager.lists.invisibleDom.length=0,a.manager.lists.deletedTModel.length=0,a.manager.lists.visibleNoDom.length=0,a.manager.visibleTypeMap={},a.manager.visibleOidMap={},a.locationManager.hasLocationList.length=0,o.foundParentWithTarget={},o.foundTypeMap={},o.foundTargetMap={}},a.isRunning=function(){return a.runningFlag},a.find=function(t){return o.find(t)},a}(t,e)).init().start(),i}function T(){return i?i.events:null}function V(){return i?i.pager:null}function C(){return i?i.loader:null}function M(){return i?i.dim.screen.width:0}function L(){return i?i.dim.screen.height:0}a.initDoms=function(t){var e=s.findByClass("tgt");t.forEach((function(t){t.$dom=null}));for(var i=a.list2map(t.filter((function(t){return"BI"!==t.type}))),n=0;n<e.length;n++){var r=e[n],o=r.getAttribute("id"),l=i[o];l&&!l.hasDom()?l.$dom=new s("#"+o):s.detach(r)}},a.list2map=function(t,e){return t.reduce((function(t,i){return t[i.oid]=a.isDefined(e)?e:i,t}),{})},a.getDeepList=function(t){var e=[];return function t(i){if(i.hasChildren()){var n=i.getChildren();e=e.concat(n),n.forEach((function(e){t(e)}))}}(t),e},a.getDeepUpdatingList=function(t){var e=[];return function t(i){i.updatingChildren&&(e=e.concat(i.updatingChildren),i.updatingChildren.forEach((function(e){t(e)})))}(t),e},a.areEqual=function(t,e,i){return i?JSON.stringify(t)===JSON.stringify(e):!(!a.isDefined(t)||!a.isDefined(e))&&t===e},a.momentum=function(t,e,i){i=i||1;var n=e-t,a=Math.abs(n)/i*5e3,r=100*a/10;return n>0?n+=r:n-=r,{distance:Math.round(n)/50,duration:a,momentumDistance:r,time:5*i}},a.isDefined=function(t){return null!=t},a.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},a.limit=function(t,e,i){return(t=(t=a.isDefined(t)?t:e)>i?i:t)<e?e:t},a.getOptionValue=function(t,e,i){return a.isDefined(t)?"function"==typeof t?t.call(i):t:e},a.executeFunctionByName=function(t,e){if(!t)return null;for(var i=Array.prototype.slice.call(arguments,2),n=t.split("."),a=n.pop(),r=0;r<n.length;r++)e=e[n[r]];return e&&e[a]?e[a].apply(e,i):void 0},a.formatPeriod=function(t){return(t=t<0?0:t)<120?t+" sec":t<7200?Math.floor(t/60)+" min":t<172800?Math.floor(t/3600)+" hours":Math.floor(t/86400)+" days"},a.formatNum=function(t,e){if(!t)return 0;var i=t.toString();return parseFloat(i).toFixed(e)},a.distance=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},a.getFullLink=function(t){if(a.isDefined(t)){if(0===t.indexOf("http"))return t;var e=window.location.protocol,i=(e+=e.endsWith(":")?"//":"://")+window.location.hostname;return t.startsWith("/")?i+t:i+"/"+t}},r.linear=function(t){return t},r.easeInQuad=function(t){return t*t},r.easeOutExpo=function(t){return 1-(1-t)*(1-t)},r.circular=function(t){return Math.sqrt(1- --t*t)},s.prototype.exists=function(){return this.selector&&(this.element=s.query(this.selector)),!!this.element},s.prototype.create=function(t){this.element=document.createElement(t)},s.prototype.setSelector=function(t){this.selector=t},s.prototype.setId=function(t){this.attr("id","#"===t[0]?t.slice(1):t)},s.prototype.focus=function(){this.element.focus()},s.prototype.attr=function(t,e){if(this.element)return a.isDefined(e)?void this.element.setAttribute(t,e):this.element.getAttribute(t)},s.prototype.opacity=function(t){if(!a.isDefined(t))return this.element.style.opacity;this.element.style.opacity=t},s.prototype.width=function(t){if(!a.isDefined(t))return this.element.offsetWidth;this.element.style.width=a.isNumber(t)?t+"px":t},s.prototype.height=function(t){if(!a.isDefined(t))return this.element.offsetHeight;this.element.style.height=a.isNumber(t)?t+"px":t},s.prototype.zIndex=function(t){return a.isDefined(t)&&(this.element.style.zIndex=t),this.element.style.zIndex},s.prototype.css=function(t){if(!a.isDefined(t))return this.attr("classs");this.attr("class",t)},s.prototype.setStyleByMap=function(t){var e=this;Object.keys(t).forEach((function(i){var n=t[i];switch(i){case"transform":e.transform.apply(e,n);break;case"width":e.width(n);break;case"height":e.height(n);break;case"zIndex":e.zIndex(n);break;case"opacity":e.opacity(n);break;default:e.setStyle(i,n)}}))},s.prototype.setStyle=function(t,e){this.element.style[t]=e},s.prototype.getStyle=function(t){return this.element.style[t]},s.prototype.getStyleValue=function(t){var e=this.getStyle(t),i=a.isDefined(e)?e.replace(/[^-\d.]/g,""):0;return parseFloat(i)},s.prototype.parent=function(){return this.element?this.element.parentElement:null},s.prototype.detach=function(){s.detach(this.element),this.$domParent&&this.$domParent.childrenCount>0&&this.$domParent.childrenCount--},s.prototype.append$Dom=function(t){this.element.appendChild(t.element)},s.prototype.appendTModel$Dom=function(t){0===this.childrenCount&&this.element.children.length>1&&t.getDomParent()&&t.getDomParent().getHtml()&&t.getDomParent().getHtml()===this.originalContent&&(this.element.innerHTML="<div>"+this.html()+"</div>"),this.element.appendChild(t.$dom.element),t.$dom.$domParent=this,this.childrenCount++},s.prototype.html=function(t){if(!a.isDefined(t))return this.originalContent;if(this.childrenCount>0){var e=document.createElement("div");e.innerHTML=t,a.isDefined(this.originalContent)?this.element.replaceChild(e,this.element.firstChild):this.element.insertBefore(e,this.element.firstChild),this.originalContent=t,this.textOnly=!1}else this.element.innerHTML=t,this.originalContent=t,this.textOnly=!1},s.prototype.text=function(t){if(!a.isDefined(t))return this.originalContent;if(this.childrenCount>0){var e=document.createTextNode(t);a.isDefined(this.originalContent)?this.element.replaceChild(e,this.element.firstChild):this.element.insertBefore(e,this.element.firstChild),this.originalContent=t,this.textOnly=!0}else this.element.textContent=t,this.originalContent=t,this.textOnly=!0},s.prototype.outerHTML=function(t){this.element.outerHTML=t},s.prototype.innerHTML=function(t){if(!a.isDefined(t))return this.element.innerHTML;this.element.innerHTML=t},s.prototype.addClass=function(t){var e=this.attr("class"),i=e?e.indexOf(t)>=0?e:e+" "+t:t;i!==e&&this.attr("class",i)},s.prototype.addEvent=function(t,e){this.element.addEventListener?this.element.addEventListener(t,e,{capture:!1,passive:!1}):this.element.attachEvent("on"+t,e)},s.prototype.detachEvent=function(t,e){this.element.removeEventListener?this.element.removeEventListener(t,e,!1):this.element.detachEvent?this.element.detachEvent("on"+t,e):this.element["on"+t]=null},s.prototype.transform=function(t,e,i,a){var r=this.createTrasformValue(t,e,i,a);r!==this.element.style[n.style.transform]&&(this.element.style[n.style.transform]=r)},s.prototype.createTrasformValue=function(t,e,i,n){return"translate("+t+"px,"+e+"px)"+(i=a.isDefined(i)&&0!==i?"rotate("+i+"deg)":"")+(a.isDefined(n)&&1!==n?"scale("+n+")":"")},s.prototype.getContext=function(t,e){var i=a.isDefined(e)?s.query(e):this.query("canvas");return i?i.getContext(t):void 0},s.prototype.findFirstByClass=function(t){return s.findFirstByClass(t,this.element)},s.prototype.findFirstByTag=function(t){return s.findFirstByTag(t,this.element)},s.prototype.query=function(t){return"#"===t[0]?s.findById(t):"."===t[0]?this.findFirstByClass(t):this.findFirstByTag(t)},s.query=function(t){return"#"===t[0]?s.findById(t):"."===t[0]?s.findFirstByClass(t):s.findFirstByTag(t)},s.findById=function(t){return document.getElementById("#"===t[0]?t.slice(1):t)},s.findFirstByClass=function(t,e){var i=s.findByClass(t,e);return i.length>0?i[0]:null},s.findFirstByTag=function(t,e){var i=s.findByTag(t,e);return i.length>0?i[0]:null},s.findByTag=function(t,e){return(e=a.isDefined(e)?e:document).getElementsByTagName(t)},s.findByClass=function(t,e){return(e=a.isDefined(e)?e:document).getElementsByClassName("."===t[0]?t.slice(1):t)},s.findNearestParentWithId=function(t){for(;t;){if("function"==typeof t.getAttribute&&t.getAttribute("id"))return t.getAttribute("id");t=t.parentElement}},s.detach=function(t){var e=a.isDefined(t)?t.parentElement:null;e&&e.removeChild(t)},s.ready=function(t){new s(document).addEvent("DOMContentLoaded",t)},s.ajax=function(t){var e=new XMLHttpRequest,i="";t.data&&(i=Object.keys(t.data).map((function(e){return e+"="+encodeURIComponent(t.data[e])})).join("&")),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var i="json"===t.dataType?JSON.parse(this.responseText):this.responseText;t.success(i)}else t.error(e.status)},"POST"===t.type?(e.open(t.type,t.url,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(i)):(t.url+=i?t.url>""&&t.url.indexOf("?")>=0?"&"+i:"?"+i:"",e.open(t.type,t.url,!0),e.send())},o.foundParentWithType={},o.foundParentWithTarget={},o.foundTypeMap={},o.foundTargetMap={},o.foundOids={},o.findFirstPinchHandler=function(t){return o.findEventHandler(t,"pinch")},o.findFirstScrollTopHandler=function(t){return o.findEventHandler(t,"scrollTop")},o.findFirstScrollLeftHandler=function(t){return o.findEventHandler(t,"scrollLeft")},o.findFirstTouchHandler=function(t){return o.findEventHandler(t,"touch")},o.findEventHandler=function(t,e){for(;t;){if(!0===t.canHandleEvents()||t.canHandleEvents()===e||Array.isArray(t.canHandleEvents())&&t.canHandleEvents().includes(e))return t;t=t.getParent()}},o.findParentWithType=function(t,e){var i,n=t.oid+"__"+e;return a.isDefined(o.foundParentWithType[n])||(function(){for(i=t.getParent();i&&i.type!==e;)i=i.getParent()}(),i&&(o.foundParentWithType[n]=i)),o.foundParentWithType[n]},o.findParentWithTarget=function(t,e){var i,n=t.oid+"__"+e;return a.isDefined(o.foundParentWithTarget[n])||(function(){for(i=t.getParent();i&&!a.isDefined(i.targets[e])&&!a.isDefined(i.targetValues[e]);)i=i.getParent()}(),i&&(o.foundParentWithTarget[n]=i)),o.foundParentWithTarget[n]},o.findByType=function(t){var e;return a.isDefined(o.foundTypeMap[t])||(e=function i(n){if(n.type===t)return n;for(var a,r=n.getChildren(),s=0;r&&s<r.length&&!a;s++)(e=r[s]).hasChildren()?a=i(e):e.type===t&&(a=e);return a}(i.ui))&&(o.foundTypeMap[t]=e),o.foundTypeMap[t]},o.findByTarget=function(t){var e;return a.isDefined(o.foundTargetMap[t])||(e=function i(n){if(n.targets[t])return n;for(var a,r=n.getChildren(),s=0;r&&s<r.length&&!a;s++)(e=r[s]).hasChildren()?a=i(e):e.targets[t]&&(a=e);return a}(i.ui))&&(o.foundTargetMap[t]=e),o.foundTargetMap[t]},o.find=function(t){var e;return a.isDefined(o.foundOids[t])||(e=function i(n){if(n.oid===t)return n;for(var a,r=n.getChildren(),s=0;r&&s<r.length&&!a;s++)(e=r[s]).hasChildren()?a=i(e):e.oid===t&&(a=e);return a}(i.ui))&&(o.foundOids[t]=e),o.foundOids[t]},l.extractInvisibles=function(t,e,i){"object"==typeof e&&e&&Object.keys(e).forEach((function(n){"onInvisible"===n&&(t.invisibleFunctions||(t.invisibleFunctions=[]),t.invisibleFunctions.push({fn:e[n],key:i}))}))},l.emptyValue=function(){return{value:void 0,step:0,steps:0,cycle:0,cycles:0,stepInterval:0,lastActualValue:void 0,actualTimeStamp:void 0,actualValueLastUpdate:0,status:"",executionCounter:0,callingTargetKey:void 0}},l.getValueStepsCycles=function(t,e,i,n,r){var s=0,o=0,l=0,u=0,c=t.getValue(r);return function e(d){return Array.isArray(d)?d.valueOnly?[d,o,l,u]:(s="function"==typeof d[0]?d[0].call(t,r,i,c):d[0],o=d.length>=2?d[1]:o,l=d.length>=3?d[2]:l,u=d.length>=4?d[3]:u,[s,o,l,u]):"object"!=typeof d||!d||d instanceof h?"function"==typeof d?e(d.call(t,r,i,c)):"number"==typeof d||"string"==typeof d||"boolean"==typeof d||d instanceof h||"object"==typeof d?[d,o,l,u]:[s,o,l,u]:(s="function"==typeof d.value?d.value.call(t,r,i,c):a.isDefined(d.value)?d.value:d,o="function"==typeof d.steps?d.steps.call(t,r,i):a.isDefined(d.steps)?d.steps:0,l="function"==typeof d.stepInterval?d.stepInterval.call(t,r,i,t.getTargetStepInterval(r),o):a.isDefined(d.stepInterval)?d.stepInterval:0,u="function"==typeof d.cycles?d.cycles.call(t,r,i,t.getTargetCycles(r)):a.isDefined(d.cycles)?d.cycles:0,Array.isArray(s)&&!1===n&&!s.valueOnly?e(s):[s,o,l,u])}(e)},l.assignValueArray=function(t,e,i){if(Array.isArray(i)){var n=i[0],r=i[1],s=i[2],o=i[3],l=t.targets[e],u=(t.getTargetCycle(e),t.targetValues[e]),h=u?u.value:void 0,c=!a.areEqual(h,n,l.deepEquality)||!a.isDefined(u)||!t.isTargetUpdating(e)&&!t.doesTargetEqualActual(e);(c||u.steps!==r||u.cycles!==o||u.stepInterval!==s)&&(t.setTargetValue(e,n,r,s,o,e),t.targetValues[e].executionCounter++,c&&(t.resetTargetStep(e),t.resetLastActualValue(e)))}},l.getIntervalValue=function(t,e,i){var n="function"==typeof i?i.call(t,e):i;return a.isNumber(n)?n:0},l.getActualSchedulePeriod=function(t,e,i){var r,s=n.now(),o=0;return i>0?a.isDefined(t.getActualTimeStamp(e))?o=(r=s-t.getActualTimeStamp(e))<i?i-r:0:(t.setActualTimeStamp(e,s),o=i):a.isDefined(t.getActualTimeStamp(e))&&(o=(r=s-t.getActualTimeStamp(e))<0?-r:0),o},l.getTargetSchedulePeriod=function(t,e,i){var r,s=n.now(),o=0;return i>0?a.isDefined(t.getTargetTimeStamp(e))?o=(r=s-t.getTargetTimeStamp(e))<i?i-r:0:(t.setTargetTimeStamp(e,s),o=i):a.isDefined(t.getTargetTimeStamp(e))&&(o=(r=s-t.getTargetTimeStamp(e))<0?-r:0),o},l.handleValueChange=function(t,e,i,n,r,s){"object"==typeof t.targets[e]&&"function"==typeof t.targets[e].onValueChange&&!a.areEqual(i,n,t.targets[e].deepEquality)&&t.targets[e].onValueChange.call(t,e,i,n,s)},l.setWidthFromDom=function(t){var e=a.isDefined(t.domWidth)?t.domWidth.width:10;a.isDefined(t.domWidth)&&t.domWidth.height===t.getHeight()&&!t.hasTargetUpdatedAfter("width","width",t.getParent())||(t.$dom.width("auto"),e=t.$dom.width()),t.domWidth={width:e,height:t.getHeight()},t.setValue("width",e)},l.setHeightFromDom=function(t){var e=a.isDefined(t.domHeight)?t.domHeight.height:10;a.isDefined(t.domHeight)&&t.domHeight.width===t.getWidth()&&!t.hasTargetUpdatedAfter("height","height",t.getParent())||(t.$dom.height("auto"),e=t.$dom.height()),t.domHeight={height:e,width:t.getWidth()},t.setValue("height",e)},u.prototype.reset=function(){var t,e;return"BI"===this.tmodel.type?(t=this.tmodel.getX()+this.tmodel.getScrollLeft(),e=this.tmodel.getY()+this.tmodel.getScrollTop(),this.xNext=t,this.xNorth=t,this.xEast=t,this.xSouth=t,this.xWest=t,this.xOverflow=a.isDefined(this.tmodel.getValue("xOverflow"))?this.tmodel.getValue("xOverflow"):t,this.yNext=e,this.yNorth=e,this.yWest=e,this.yEast=e,this.ySouth=this.tmodel.getRealParent().viewport?this.tmodel.getRealParent().viewport.ySouth:e):(t=this.tmodel.getX(),e=this.tmodel.getY(),this.xNext=t,this.xNorth=t,this.xEast=t,this.xSouth=t,this.xWest=t,this.xOverflow=a.isDefined(this.tmodel.getValue("xOverflow"))?this.tmodel.getValue("xOverflow"):t,this.yNext=e,this.yNorth=e,this.yWest=e,this.yEast=e,this.ySouth=e),this},u.prototype.setCurrentChild=function(t){this.currentChild=t,this.xOffset=t.getDomParent()?-t.getDomParent().getX():0,this.yOffset=t.getDomParent()?-t.getDomParent().getY():0},u.prototype.getXNext=function(){return this.xNext+this.currentChild.getLeftMargin()+this.xOffset-this.tmodel.getScrollLeft()},u.prototype.getYNext=function(){return this.yNext+this.currentChild.getTopMargin()+this.yOffset-this.tmodel.getScrollTop()},u.prototype.isXVisible=function(t,e,i,n,a){return"BI"===t.type||e<=a&&i>=n},u.prototype.isYVisible=function(t,e,i,n,a){return e<=a&&i>=n},u.prototype.isVisible=function(t){var e=t.getDomParent()?t.getDomParent().getScale():1,n=i.dim.screen.x,a=i.dim.screen.y,r=i.dim.screen.width,s=i.dim.screen.height,o=t.getX(),l=t.getY();t.getDomHolder()!==i.$dom?(n=t.getDomParent().isInFlow()?t.getDomParent().absX:t.getDomParent().getX(),a=t.getDomParent().isInFlow()?t.getDomParent().absY:t.getDomParent().getY(),r=Math.min(r,n+t.getDomParent().getWidth()),s=Math.min(s,a+t.getDomParent().getHeight()),n=Math.max(0,n),a=Math.max(0,a),o=t.getDomParent().isInFlow()?t.getDomParent().absX+t.getX():t.getDomParent().getX()+t.getX(),l=t.getDomParent().isInFlow()?t.getDomParent().absY+t.getY():t.getDomParent().getY()+t.getY()):"BI"===t.type&&(r=t.getRealParent().getX()+t.getRealParent().getWidth(),s=t.getRealParent().getY()+t.getRealParent().getHeight());var u=e*t.getTargetScale(),h=u*t.getTargetWidth(),c=u*t.getTargetHeight();return t.xVisible=this.isXVisible(t,o,o+h,n,r),t.yVisible=this.isYVisible(t,l,l+c,a,s),t.isVisible()},u.prototype.isOverflow=function(t,e){if(a.isNumber(t)&&a.isNumber(e))return t>e},u.prototype.overflow=function(){this.xNext=this.xOverflow,this.yNext=this.ySouth},u.prototype.appendNewLine=function(){var t=this.currentChild.getHeight()*this.currentChild.getScale();this.xNext=this.xOverflow,this.yNext=this.ySouth+t+this.currentChild.getTopMargin()+this.currentChild.getBottomMargin()+this.currentChild.getValue("appendNewLine"),this.yEast=this.yNext,this.xSouth=this.xNext,this.ySouth=Math.max(this.yNext,this.ySouth),this.currentChild.getRealParent().viewport.xEast=Math.max(this.currentChild.getRealParent().viewport.xEast,this.xEast),this.currentChild.getRealParent().viewport.ySouth=Math.max(this.currentChild.getRealParent().viewport.ySouth,this.ySouth)},u.prototype.nextLocation=function(){var t=this.currentChild.getInnerWidth()*this.currentChild.getScale(),e=this.currentChild.getInnerHeight()*this.currentChild.getScale(),i=this.currentChild.getInnerContentHeight()*this.currentChild.getScale(),n=this.yNext+e+this.currentChild.getTopMargin()+this.currentChild.getBottomMargin();this.xNext+=t+this.currentChild.getLeftMargin()+this.currentChild.getRightMargin(),this.yNext+=i,this.xSouth=this.xNext,this.yEast=this.yNext,this.xEast=Math.max(this.xNext,this.xEast),this.ySouth=Math.max(n,this.ySouth),this.currentChild.getRealParent().viewport.xEast=Math.max(this.currentChild.getRealParent().viewport.xEast,this.xEast),this.currentChild.getRealParent().viewport.ySouth=Math.max(this.currentChild.getRealParent().viewport.ySouth,this.ySouth)},u.prototype.calcContentWidthHeight=function(){this.tmodel.contentHeight=this.ySouth-this.yNorth,this.tmodel.innerContentHeight=this.yEast-this.yNorth,this.tmodel.innerContentWidth=this.xSouth-this.xWest,this.tmodel.contentWidth=this.xEast-this.xWest},h.prototype.getParent=function(){return this.parent},h.prototype.getRealParent=function(){return this.parent},h.prototype.getDomParent=function(){return this.actualValues.domParent?this.actualValues.domParent:null},h.prototype.getDomHolder=function(){return this.getDomParent()?this.getDomParent().$dom:i.$dom},h.prototype.hasDomHolderChanged=function(){return this.getDomHolder()&&this.getDomHolder().exists()&&this.$dom.parent().getAttribute("id")!==this.getDomHolder().attr("id")},h.prototype.hasDom=function(){return!!this.$dom&&this.$dom.exists()},h.prototype.hasChildren=function(){return this.getChildren().length>0},h.prototype.getChildren=function(){if(!this.getActualValueLastUpdate("allChildren")||this.getActualValueLastUpdate("children")>=this.getActualValueLastUpdate("allChildren")||this.getActualValueLastUpdate("addedChildren")>=this.getActualValueLastUpdate("allChildren")){if(this.actualValues.allChildren=this.actualValues.children.concat(this.actualValues.addedChildren),this.actualValues.children.length>0){var t=this;this.actualValues.children.forEach((function(e){e.parent=t})),this.actualValues.allChildren.sort((function(t,e){return!t.canBeBracketed()&&e.canBeBracketed()?-1:1}))}this.targetValues.allChildren?this.setActualValueLastUpdate("allChildren"):this.setTargetValue("allChildren",this.actualValues.allChildren)}return this.actualValues.allChildren},h.prototype.getAllNestedChildren=function(){var t=[];return function e(i){if(i.hasChildren()){var n=i.getChildren();t=t.concat(n),n.forEach((function(t){e(t)}))}}(this),t},h.prototype.getLastChild=function(){return this.hasChildren()?this.getChildren()[this.getChildren().length-1]:void 0},h.prototype.getFirstChild=function(){return this.hasChildren()?this.getChildren()[0]:void 0},h.prototype.getChild=function(t){return this.hasChildren()?this.getChildren()[t]:void 0},h.prototype.getChildIndex=function(t){return this.getChildren().indexOf(t)},h.prototype.getChildrenOids=function(){return this.getChildren().oids()},h.prototype.filterChildren=function(t){return this.getChildren().filter((function(e){return Array.isArray(t)?t.includes(e.type):"function"==typeof t?t.call(e):e.type===t}))},h.prototype.findChild=function(t){return this.getChildren().find((function(e,i){return"function"==typeof t?t.call(e):e.type===t}))},h.prototype.findLastChild=function(t){return this.getChildren().findLast((function(e){return"function"==typeof t?t.call(e):e.type===t}))},h.prototype.getParentValue=function(t){var e=o.findParentWithTarget(this,t);return e?e.getValue(t):void 0},h.prototype.getGlobalValue=function(t){var e=o.findByTarget(t);return e?e.getValue(t):void 0},h.prototype.getGlobalValueByType=function(t,e){var i=o.findByType(t);return i?i.getValue(e):void 0},h.prototype.getContentHeight=function(){return this.contentHeight},h.prototype.getInnerContentHeight=function(){return 0},h.prototype.getInnerHeight=function(){return a.isDefined(this.actualValues.innerHeight)?this.actualValues.innerHeight:this.getHeight()},h.prototype.getInnerWidth=function(){return a.isDefined(this.actualValues.innerWidth)?this.actualValues.innerWidth:this.getWidth()},h.prototype.getContentWidth=function(){return this.contentWidth},h.prototype.getUIDepth=function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},h.prototype.resetVisibleList=function(){this.inFlowVisibles.length=0},h.prototype.addToParentVisibleList=function(){this.isVisible()&&this.isInFlow()&&this.getParent()&&this.getParent().inFlowVisibles.push(this)},h.prototype.isVisible=function(){return this.xVisible&&this.yVisible},h.prototype.createViewport=function(){return this.viewport=this.viewport?this.viewport.reset():new u(this),this.viewport},h.prototype.setLocation=function(t){this.x=t.getXNext(),this.y=t.getYNext(),this.absX=this.getDomParent()?this.getDomParent().absX+this.x:this.x,this.absY=this.getDomParent()?this.getDomParent().absY+this.y:this.y;var e=o.findFirstScrollTopHandler(this),i=o.findFirstScrollLeftHandler(this);this.deepX=this.absX+(e?e.getScrollTop():0),this.deepY=this.absY+(i?i.getScrollLeft():0)},h.prototype.shouldCalculateChildrenLocations=function(){return this.isVisible()&&this.canBeVisible()&&(this.hasChildren()||this.getContentHeight()>0)},h.prototype.manuallyCalculateChildrenLocations=function(){},h.prototype.fixOpacity=function(){var t=this.getOpacity().toFixed(2);this.$dom.opacity()!==t&&this.$dom.opacity(t)},h.prototype.fixCss=function(){var t=this.getCss();this.$dom.css()!==t&&this.$dom.css(t)},h.prototype.fixStyle=function(){var t=this.getStyle();a.isDefined(t)&&this.domValues.style!==t&&(this.$dom.setStyleByMap(t),this.domValues.style=t)},h.prototype.fixXYRotateScale=function(){var t=Math.floor(this.getX()),e=Math.floor(this.getY()),i=Math.floor(this.getRotate()),n=a.formatNum(this.getScale(),2);this.domValues.x===t&&this.domValues.y===e&&this.domValues.rotate===i&&this.domValues.scale===n||(this.$dom.transform(t,e,i,n),this.domValues.y=e,this.domValues.x=t,this.domValues.rotate=i,this.domValues.scale=n)},h.prototype.fixDim=function(){var t=Math.floor(this.getWidth()),e=Math.floor(this.getHeight());this.$dom.width()===t&&this.$dom.height()===e||(this.$dom.width(t),this.$dom.height(e))},h.prototype.fixZIndex=function(){var t=Math.floor(this.getZIndex());this.$dom.zIndex()!==t&&this.$dom.zIndex(t)},h.prototype.isMarkedDeleted=function(){return!0===this.getValue("tmodelDeletedFlag")},h.prototype.markAsDeleted=function(){this.setTargetValue("tmodelDeletedFlag",!0),this.getChildren().forEach((function(t){t.markAsDeleted()}))},h.prototype.isTextOnly=function(){return this.actualValues.textOnly},h.prototype.getHtml=function(){return this.actualValues.html},h.prototype.isOverflowHidden=function(){return this.actualValues.isOverflowHidden},h.prototype.isInFlow=function(){return this.actualValues.isInFlow},h.prototype.canHandleEvents=function(){return this.actualValues.canHandleEvents},h.prototype.canBeBracketed=function(){return this.actualValues.canBeBracketed},h.prototype.canBeVisible=function(){return this.actualValues.canBeVisible},h.prototype.canHaveDom=function(){return this.actualValues.canHaveDom},h.prototype.isDomDeletable=function(){return this.actualValues.isDomDeletable},h.prototype.getOpacity=function(){return this.actualValues.opacity},h.prototype.getX=function(){return this.actualValues.x},h.prototype.getY=function(){return this.actualValues.y},h.prototype.getZIndex=function(){return this.actualValues.zIndex},h.prototype.getScale=function(){return this.actualValues.scale},h.prototype.getValue=function(t){return this.actualValues[t]},h.prototype.getTopMargin=function(){return this.actualValues.topMargin},h.prototype.getLeftMargin=function(){return this.actualValues.leftMargin},h.prototype.getRightMargin=function(){return this.actualValues.rightMargin},h.prototype.getBottomMargin=function(){return this.actualValues.bottomMargin},h.prototype.getRotate=function(){return this.actualValues.rotate},h.prototype.getWidth=function(){return this.actualValues.width},h.prototype.getHeight=function(){return this.actualValues.height},h.prototype.getScrollTop=function(){return Math.floor(this.actualValues.scrollTop)},h.prototype.getScrollLeft=function(){return Math.floor(this.actualValues.scrollLeft)},h.prototype.getCss=function(){return this.actualValues.css.indexOf("tgt")>=0?this.actualValues.css:this.actualValues.css?"tgt "+this.actualValues.css:"tgt"},h.prototype.getStyle=function(){return this.actualValues.style},h.prototype.getScaledWidth=function(){return this.getWidth()*this.getScale()},h.prototype.getScaledHeight=function(){return this.getHeight()*this.getScale()},h.prototype.getTargetStepPercent=function(t,e){var i=this.getTargetSteps(t);return e=a.isDefined(e)?e:this.getTargetStep(t),i?e/i:1},h.prototype.resetTargetStep=function(t){this.targetValues[t]&&(this.targetValues[t].step=0)},h.prototype.resetTargetCycle=function(t){this.targetValues[t]&&(this.targetValues[t].cycle=0)},h.prototype.resetActualTimeStamp=function(t){this.targetValues[t]&&(this.targetValues[t].actualTimeStamp=void 0)},h.prototype.resetLastActualValue=function(t){this.targetValues[t]&&(this.targetValues[t].lastActualValue=void 0)},h.prototype.hasTargetUpdatedAfter=function(t,e,i){var r=!1,s=(i=a.isDefined(i)?i:this)?i.getActualValueLastUpdate(e):0;return s>0&&(!this.targetLastUpdateMap[t+"_"+e]||this.targetLastUpdateMap[t+"_"+e]-s<10)&&(r=!0,this.targetLastUpdateMap[t+"_"+e]=n.now()),r},h.prototype.updateTargetStatus=function(t){if(this.targetValues[t]){var e=this.getTargetCycle(t),i=this.getTargetCycles(t),n=this.getTargetStep(t),a=this.getTargetSteps(t);this.targetValues[t].status="",(a>0||i>0)&&(n<a||e<i||!this.doesTargetEqualActual(t))?this.targetValues[t].status="updating":!this.doesTargetEqualActual(t)&&this.isTargetInLoop(t)||(this.targetValues[t].status="done")}},h.prototype.getTargetStatus=function(t){return this.targetValues[t]?this.targetValues[t].status:0},h.prototype.isTargetUpdating=function(t){return this.targetValues[t]&&"updating"===this.targetValues[t].status},h.prototype.isTargetDone=function(t){return this.targetValues[t]&&"done"===this.targetValues[t].status},h.prototype.isTargetComplete=function(t){return this.targetValues[t]&&"complete"===this.targetValues[t].status},h.prototype.hasTargetGotExecuted=function(t){return!this.targets[t]||this.targetValues[t]&&this.targetValues[t].executionCounter>0},h.prototype.setTargetComplete=function(t){this.targetValues[t]&&(this.targetValues[t].status="complete")},h.prototype.isTargetEnabled=function(t){var e=this.targets[t];return!(!a.isDefined(e)||!1===e.enabledOn||"function"==typeof e.enabledOn&&!e.enabledOn.call(this,t))},h.prototype.isTargetInLoop=function(t){return a.isDefined(this.targets[t])&&this.targets[t].loop},h.prototype.enableTargetLoop=function(t){a.isDefined(this.targets[t])&&(this.targets[t].loop=!0)},h.prototype.disableTargetLoop=function(t){a.isDefined(this.targets[t])&&(this.targets[t].loop=!1)},h.prototype.doesTargetEqualActual=function(t){return this.targetValues[t]&&this.getTargetValue(t)===this.getValue(t)},h.prototype.getTargetValue=function(t){return this.targetValues[t]?"function"==typeof this.targetValues[t].value?this.targetValues[t].value.call(this):this.targetValues[t].value:void 0},h.prototype.getTargetSteps=function(t){return this.targetValues[t]&&this.targetValues[t].steps||0},h.prototype.getTargetStep=function(t){return this.targetValues[t]?this.targetValues[t].step:0},h.prototype.getActualTimeStamp=function(t){return this.targetValues[t]?this.targetValues[t].actualTimeStamp:void 0},h.prototype.getLastActualValue=function(t){return this.targetValues[t]?this.targetValues[t].lastActualValue:void 0},h.prototype.getActualValueLastUpdate=function(t){return this.targetValues[t]?this.targetValues[t].actualValueLastUpdate:void 0},h.prototype.setTargetStep=function(t,e){return this.targetValues[t]&&(this.targetValues[t].step=e),this.targetValues[t].step},h.prototype.getTargetCycles=function(t){return this.targetValues[t]&&this.targetValues[t].cycles||0},h.prototype.getTargetCycle=function(t){return this.targetValues[t]?this.targetValues[t].cycle:0},h.prototype.setTargetCycle=function(t,e){this.targetValues[t]&&(this.targetValues[t].cycle=e)},h.prototype.setActualTimeStamp=function(t,e){this.targetValues[t]&&(this.targetValues[t].actualTimeStamp=e)},h.prototype.setLastActualValue=function(t,e){this.targetValues[t]&&(this.targetValues[t].lastActualValue=e)},h.prototype.setActualValueLastUpdate=function(t){this.targetValues[t]&&(this.targetValues[t].actualValueLastUpdate=n.now())},h.prototype.getTargetEasing=function(t){return"object"==typeof this.targets[t]&&this.targets[t].easing?this.targets[t].easing:void 0},h.prototype.getTargetStepInterval=function(t){return this.targetValues[t]?this.targetValues[t].stepInterval:void 0},h.prototype.getTargetEventFunctions=function(t){return this.targetValues[t]?this.targetValues[t].events:void 0},h.prototype.getCallingTargetKey=function(t){return this.targetValues[t]?this.targetValues[t].callingTargetKey:void 0},h.prototype.resetCallingTargetKey=function(t){this.targetValues[t]&&(this.targetValues[t].callingTargetKey=t)},h.prototype.setTargetValue=function(t,e,n,r,s,o){if(!a.isDefined(this.targetValues[t])||e!==this.targetValues[t].value||e!==this.actualValues[t]||n||s||r||"object"==typeof this.targets[t]){if(n=n||0,s=s||0,r=r||0,this.targetValues[t]?(t===o||this.targetValues[t].callingTargetKey===o&&e===this.targetValues[t].value||(this.targetValues[t].step=0),this.targetValues[t].value=e,this.targetValues[t].steps=n,this.targetValues[t].cycles=s,this.targetValues[t].stepInterval=r,this.targetValues[t].callingTargetKey=o):(this.targetValues[t]=Object.assign(l.emptyValue(),{value:e,steps:n,cycles:s,stepInterval:r,callingTargetKey:o}),l.extractInvisibles(this,this.targets[t],t)),0===n&&0===s){var u=this.actualValues[t];this.actualValues[t]="function"==typeof e?e.call(this):e,this.setActualValueLastUpdate(t),l.handleValueChange(this,t,this.actualValues[t],u,0,0)}this.updateTargetStatus(t),this.isTargetUpdating(t)&&t!==o&&(this.activeTargetKeyMap[t]=!0,this.targetUpdatingMap[t]||(this.targetUpdatingList.push(t),this.targetUpdatingMap[t]=t),this.resetLastActualValue(t)),i.manager.scheduleRun(10,"setTargetValue-"+(this.getParent()?this.getParent().oid:"")+"-"+this.oid+"-"+t)}},h.prototype.setValue=function(t,e){this.actualValues[t]=e},h.prototype.addChild=function(t,e){var n=this.actualValues.addedChildren;return e=t.canBeBracketed()?a.isDefined(e)?e:n.length:0,t.parent=this,e>=n.length?n.push(t):n.splice(e,0,t),this.setActualValueLastUpdate("children"),this.targetValues.addedChildren?this.setActualValueLastUpdate("addedChildren"):this.setTargetValue("addedChildren",n),i.manager.scheduleRun(10,"addChild-"+this.oid+"-"+t.oid),e},h.prototype.addUpdatingChild=function(t){-1===this.updatingChildren.indexOf(t)&&this.updatingChildren.push(t)},h.prototype.removeUpdatingChild=function(t){var e=this.updatingChildren.indexOf(t);e>=0&&this.updatingChildren.splice(e,1)},h.prototype.addTarget=function(t,e){this.targets[t]=e,this.activeTargetKeyMap[t]=!0,delete this.targetValues[t],i.manager.scheduleRun(10,"addTarget-"+this.oid+"-"+t)},h.prototype.deleteTargetValue=function(t){delete this.targetValues[t],this.activeTargetKeyMap[t]=!0,i.manager.scheduleRun(10,"deleteTargetValue-"+this.oid+"-"+t)},h.prototype.getTargetHeight=function(){return this.getTargetValue("height")||1},h.prototype.getTargetWidth=function(){return this.getTargetValue("width")||1},h.prototype.getTargetScale=function(){return this.getTargetValue("scale")||1},c.prototype.removeHandlers=function(){if(this.bindedHandleEvent){var t=this;Object.keys(this.eventMap).forEach((function(e){("resize"===t.eventMap[e]?i.window:i.$dom).detachEvent(e,t.bindedHandleEvent)}))}},c.prototype.addHandlers=function(){this.bindedHandleEvent=this.bindedHandleEvent?this.bindedHandleEvent:this.handleEvent.bind(this);var t=this;Object.keys(this.eventMap).forEach((function(e){("resize"===t.eventMap[e]?i.window:i.$dom).addEvent(e,t.bindedHandleEvent)}))},c.prototype.captureEvents=function(){this.lastEvent?(this.findEventHandlers(this.lastEvent),this.currentEvent=this.eventName,this.eventName="",this.lastEvent=void 0):this.currentEvent=""},c.prototype.handleEvent=function(t){if(!this.eventName||this.eventName===this.currentEvent){switch(this.eventTagName=(t.target.tagName||"").toUpperCase(),this.eventName=this.eventMap[t.type],this.eventName){case"touchstart":this.clear(),["INPUT","TEXTAREA"].includes(this.eventTagName)||(this.touchCount=this.countTouches(t),t.preventDefault(),this.start(t));break;case"touchmove":var e=this.getTouch(t);this.cursor.x=e.x,this.cursor.y=e.y,t.preventDefault(),this.touchCount>0&&this.move(t);break;case"touchend":t.preventDefault(),this.end(t);break;case"wheel":t.preventDefault(),this.wheel(t);break;case"key":this.keyUpHandler(t);break;case"resize":i.dim.measureScreen()}this.lastEvent=t,i.manager.scheduleRun(0,this.eventName+"-"+this.eventTagName)}},c.prototype.findEventHandlers=function(t){var e="function"==typeof t.target.getAttribute?t.target.getAttribute("id"):"";e||(e=s.findNearestParentWithId(t.target));var n=i.manager.visibleOidMap[e],a=n?o.findFirstTouchHandler(n):null,r=n?o.findFirstScrollLeftHandler(n):null,l=n?o.findFirstScrollTopHandler(n):null,u=n?o.findFirstPinchHandler(n):null;this.currentHandlers.touch=a,this.currentHandlers.scrollLeft=r,this.currentHandlers.scrollTop=l,this.currentHandlers.pinch=u},c.prototype.clear=function(){this.start0=void 0,this.start1=void 0,this.end0=void 0,this.end1=void 0,this.touchCount=0,this.resetCurrentTouch()},c.prototype.resetCurrentTouch=function(){this.currentTouch.deltaY=0,this.currentTouch.deltaX=0,this.currentTouch.pinchDelta=0,this.currentTouch.manualMomentumFlag=!1,this.currentTouch.orientation="none",this.currentTouch.key=""},c.prototype.resetEvents=function(){if(this.currentTouch.timeStamp>0){var t=n.now()-this.currentTouch.timeStamp,e=0;Math.abs(this.currentTouch.deltaY)>.001||Math.abs(this.currentTouch.deltaX)>.001||Math.abs(this.currentTouch.pinchDelta)>.001?t>70?(this.currentTouch.deltaY=0,this.currentTouch.deltaX=0,this.currentTouch.pinchDelta=0):this.currentTouch.manualMomentumFlag&&(this.currentTouch.deltaY*=.95,this.currentTouch.deltaX*=.95,e=10):t>600&&(this.clear(),this.currentTouch.timeStamp=0),i.manager.scheduleRun(e,"scroll decay")}else(this.eventName||this.lastEvent)&&(this.eventName="",i.manager.scheduleRun(1,"reseting current event"))},c.prototype.getTouchHandler=function(){return this.currentHandlers.touch},c.prototype.getTouchHandlerType=function(){return this.currentHandlers.touch?this.currentHandlers.touch.type:null},c.prototype.getTouchHandlerOid=function(){return this.currentHandlers.touch?this.currentHandlers.touch.oid:null},c.prototype.isClickEvent=function(){return"click"===this.currentEvent},c.prototype.isResizeEvent=function(){return"resize"===this.currentEvent},c.prototype.getCurrentEvent=function(){return this.currentEvent},c.prototype.isClickHandler=function(t){return this.getTouchHandler()===t&&this.isClickEvent()},c.prototype.isClickHandlerType=function(t){return this.getTouchHandlerType()===t&&this.isClickEvent()},c.prototype.isTouchHandler=function(t){return this.getTouchHandler()===t},c.prototype.isTouchHandlerType=function(t){return this.getTouchHandlerType()===t},c.prototype.isTouchHandlerOrAncestor=function(t){for(var e=this.getTouchHandler();e;){if(e===t)return!0;e=e.getParent()}return!1},c.prototype.isScrollLeftHandler=function(t){return this.currentHandlers.scrollLeft===t},c.prototype.isScrollTopHandler=function(t){return this.currentHandlers.scrollTop===t},c.prototype.isPinchHandler=function(t){return this.currentHandlers.pinch===t},c.prototype.countTouches=function(t){return t.touches&&t.touches.length?t.touches.length:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length?t.originalEvent.touches.length:1},c.prototype.keyUpHandler=function(t){var e=(t=t||window.event).which||t.keyCode;this.currentTouch.key=e,37===e?this.setDeltaXDeltaY(-10,0):38===e?this.setDeltaXDeltaY(0,-10):39===e?this.setDeltaXDeltaY(10,0):40===e&&this.setDeltaXDeltaY(0,10)},c.prototype.getTouch=function(t,e){if(t){e=e||0;var i=t.touches&&t.touches[e]?t.touches[e]:t;return i.originalEvent&&i.originalEvent.touches&&(i=i.originalEvent.touches[e]),{x:i.pageX||i.clientX||0,y:i.pageY||i.clientY||0,target:i.target,timeStamp:n.now()}}},c.prototype.start=function(t){return this.start0=this.getTouch(t),this.start1=this.getTouch(t,1),this.cursor.x=this.start0.x,this.cursor.y=this.start0.y,t.stopPropagation()},c.prototype.move=function(t){var e,i;if(1===this.touchCount)this.start0.y=this.end0?this.end0.y:this.start0.y,this.start0.x=this.end0?this.end0.x:this.start0.x,this.end0=this.getTouch(t),this.start1=void 0,this.end1=void 0,a.isDefined(this.end0)&&(e=this.start0.x-this.end0.x,i=this.start0.y-this.end0.y,this.setDeltaXDeltaY(e,i));else if(this.touchCount>=2){this.end0=this.getTouch(t),this.end1=this.getTouch(t,1);var n=a.distance(this.start0.x,this.start0.y,this.start1.x,this.start1.y),r=a.distance(this.end0.x,this.end0.y,this.end1.x,this.end1.y);this.currentTouch.diff=r-n,this.setCurrentTouchParam("pinchDelta",this.currentTouch.diff>0?.3:this.currentTouch.diff<0?-.3:0)}return t.stopPropagation()},c.prototype.end=function(t){var e;a.isDefined(this.end0)||(this.end0=this.getTouch(t));var i=a.isDefined(this.end0)&&a.isDefined(this.start0)?this.end0.timeStamp-this.start0.timeStamp:0;if(this.touchCount<=1&&a.isDefined(this.end0)&&a.isDefined(this.start0)){var n=this.start0.x-this.end0.x,r=this.start0.y-this.end0.y,s=this.end0.timeStamp-this.start0.timeStamp;"horizontal"===this.currentTouch.orientation&&Math.abs(n)>1?(e=a.momentum(0,n,s),this.setCurrentTouchParam("deltaX",e.distance,e.duration),this.currentTouch.manualMomentumFlag=!0):"vertical"===this.currentTouch.orientation&&Math.abs(r)>1&&(e=a.momentum(0,r,s),this.setCurrentTouchParam("deltaY",e.distance,e.duration),this.currentTouch.manualMomentumFlag=!0)}return!e&&1===this.touchCount&&i<300&&(this.eventName="click",this.clear(),this.currentTouch.timeStamp=0),this.touchCount=0,t.stopPropagation()},c.prototype.setDeltaXDeltaY=function(t,e){var i=Math.abs(t)-Math.abs(e);i>=1?("none"===this.currentTouch.orientation||"vertical"===this.currentTouch.orientation&&i>3||"horizontal"===this.currentTouch.orientation)&&(this.currentTouch.orientation="horizontal",this.currentTouch.dir=this.currentTouch.deltaX<=-1?"left":this.currentTouch.deltaX>=1?"right":this.currentTouch.dir,this.setCurrentTouchParam("deltaX",t),this.currentTouch.deltaY=0):"none"===this.currentTouch.orientation||"horizontal"===this.currentTouch.orientation&&i<-3||"vertical"===this.currentTouch.orientation?(this.currentTouch.orientation="vertical",this.currentTouch.dir=this.currentTouch.deltaY<=-1?"up":this.currentTouch.deltaY>=1?"down":this.currentTouch.dir,this.setCurrentTouchParam("deltaY",e),this.currentTouch.deltaX=0):(this.currentTouch.deltaX=0,this.currentTouch.deltaY=0)},c.prototype.setCurrentTouchParam=function(t,e,i){this.currentTouch[t]=e,this.currentTouch.timeStamp=a.isDefined(i)?n.now()+i:Math.max(this.currentTouch.timeStamp,n.now())},c.prototype.wheel=function(t){var e=0,i=0;this.currentTouch.pinchDelta=0,this.start0=this.getTouch(t),t.ctrlKey&&"deltaY"in t?this.setCurrentTouchParam("pinchDelta",-t.deltaY/10):"deltaX"in t?(e=t.deltaX,i=t.deltaY):"wheelDeltaX"in t?(e=-t.wheelDeltaX/120,i=-t.wheelDeltaY/120):"wheelDelta"in t?e=-t.wheelDelta/120:"detail"in t&&(e=t.detail/3),this.setDeltaXDeltaY(e,i)},d.prototype.initSingleLoad=function(t,e,i){this.isLoading(t)||this.isLoaded(t)&&!i||this.getLoadingAttempts(t)>this.stopLoadingAfterAttempts||(this.initLoadingMap(t),this.singleLoadList=this.singleLoadList?this.singleLoadList:{},this.singleLoadList[t]={fetchId:t,query:e})},d.prototype.initGroupLoad=function(t,e,i,n,a){var r=JSON.stringify({query:i,idKey:n,separator:a});this.isLoading(t)||this.isLoaded(t)||this.getLoadingAttempts(t)>this.stopLoadingAfterAttempts||(this.initLoadingMap(t),this.groupLoadList=this.groupLoadList?this.groupLoadList:{},this.groupLoadList[r]||(this.groupLoadList[r]=[]),this.groupLoadList[r].push({fetchId:t,dataId:e}))},d.prototype.initImgLoad=function(t,e){this.isLoading(t)||this.isLoaded(t)||this.getLoadingAttempts(t)>this.stopLoadingAfterAttempts||(this.initLoadingMap(t,"image"),this.imgLoadList=this.imgLoadList?this.imgLoadList:{},this.imgLoadList[t]={fetchId:t,src:e})},d.prototype.isLoading=function(t){return!!a.isDefined(this.loadingMap[t])&&this.loadingMap[t].loadingFlag},d.prototype.isLoaded=function(t){return a.isDefined(this.resultMap[t])&&!0===this.resultMap[t].success},d.prototype.getLoadingAttempts=function(t){return a.isDefined(this.loadingMap[t])?this.loadingMap[t].attempts:0},d.prototype.getSuccessLoadingTime=function(t){return a.isDefined(this.loadingMap[t])&&!0===this.loadingMap[t].success?this.loadingMap[t].loadingTime:void 0},d.prototype.getFailedInterval=function(t){return a.isDefined(this.loadingMap[t])?this.loadingMap[t].attempts*this.attemptFailedInterval:0},d.prototype.fetchResult=function(t){return this.resultMap[t]},d.prototype.hasLoadedSuccessfully=function(t){return this.resultMap[t]&&!0===this.resultMap[t].success},d.prototype.hasLoadedUnsuccessfully=function(t){return this.resultMap[t]&&!1===this.resultMap[t].success},d.prototype.fetchErrors=function(t){return this.resultMap[t]&&this.resultMap[t].result&&this.resultMap[t].result.errors?this.resultMap[t].result.errors:void 0},d.prototype.initLoadingMap=function(t,e){e=e||this.getCategoryFromFetchId(t),a.isDefined(this.loadingMap[t])?(this.loadingMap[t].loadingFlag=!0,this.loadingMap[t].startTime=n.now(),this.loadingMap[t].loadingTime=void 0):this.loadingMap[t]={fetchId:t,category:e,loadingFlag:!0,attempts:0,startTime:n.now(),loadingTime:void 0,success:!1}},d.prototype.groupLoad=function(){if(this.groupLoadList){for(var t=Object.keys(this.groupLoadList),e=0;e<t.length;e++){for(var i=t[e],n=this.groupLoadList[i],a=[],r={},s=0;s<n.length;s++){var o=n[s].dataId;a.push(o),r[o]=n[s].fetchId}if(a.length>0){var l=JSON.parse(i),u=this.updateQueryValue(l.query,a.join(l.separator));this.groupAjax(u,r,l.idKey)}delete this.groupLoadList[i]}this.groupLoadList=void 0}},d.prototype.singleLoad=function(){if(this.singleLoadList){for(var t=Object.keys(this.singleLoadList),e=0;e<t.length;e++){var i=this.singleLoadList[t[e]];this.singleAjax(i.query,i.fetchId)}this.singleLoadList=void 0}},d.prototype.imgLoad=function(){if(this.imgLoadList){for(var t=Object.keys(this.imgLoadList),e=0;e<t.length;e++){var i=this.imgLoadList[t[e]];this.imgAjax(i.src,i.fetchId)}this.imgLoadList=void 0}},d.prototype.updateQueryValue=function(t,e){for(var i in t)"%s"===t[i]?t[i]=e:"%d"===t[i]?t[i]="number"==typeof e?e:parseFloat(e):"object"==typeof t[i]&&this.updateQueryValue(t[i],e);return t},d.prototype.singleAjax=function(t,e){var a=this,r={dataType:"json",type:"GET",success:function(t){a.loadingMap[e].loadingFlag=!1,a.loadingMap[e].loadingTime=n.now()-a.loadingMap[e].startTime,a.loadingMap[e].success=!0,a.loadingMap[e].attempts++,a.resultMap[e]=Object.assign({result:t},a.loadingMap[e]),delete a.loadingMap[e],a.updateStatistics(e),i.manager.scheduleRun(0,"singleAjax_success_"+e)},error:function(t){a.resultMap[e]={error:t,success:!1},a.loadingMap[e].loadingFlag=!1,a.loadingMap[e].loadingTime=n.now()-a.loadingMap[e].startTime,a.loadingMap[e].attempts++,i.manager.scheduleRun(0,"singleAjax_error_"+e)}};s.ajax(Object.assign(r,t))},d.prototype.groupAjax=function(t,e,a){var r=this,o={dataType:"json",type:"GET",success:function(s){for(var o=0;o<s.length;o++){var l=s[o][a];if(e[l]){var u=e[l];r.loadingMap[u].loadingFlag=!1,r.loadingMap[u].loadingTime=n.now()-r.loadingMap[u].startTime,r.loadingMap[u].success=!0,r.loadingMap[u].attempts++,r.resultMap[u]=Object.assign({result:s[o]},r.loadingMap[u]),r.updateStatistics(u),delete r.loadingMap[u],delete e[l]}}Object.keys(e).forEach((function(t){var i=e[t];r.loadingMap[i].success||(r.loadingMap[i].loadingFlag=!1,r.loadingMap[i].loadingTime=n.now()-r.loadingMap[i].startTime,r.loadingMap[i].attempts++)})),i.manager.scheduleRun(0,"groupAjax_success_"+t)},error:function(n){Object.keys(e).forEach((function(t){var i=e[t];r.resultMap[i]={error:n,success:!1},r.loadingMap[i].loadingFlag=!1,r.loadingMap[i].attempts++})),i.manager.scheduleRun(0,"groupAjax_error_"+t)}};s.ajax(Object.assign(o,t))},d.prototype.imgAjax=function(t,e){var a=this,r=new Image;r.src=t,r.onload=function(){a.loadingMap[e].loadingFlag=!1,a.loadingMap[e].loadingTime=n.now()-a.loadingMap[e].startTime,a.loadingMap[e].success=!0,a.loadingMap[e].attempts++,a.resultMap[e]=Object.assign({width:this.width,height:this.height,$image:new s(r)},a.loadingMap[e]),a.updateStatistics(e,"image"),delete a.loadingMap[e],i.manager.scheduleRun(0,"imgAjax_success_"+e)},r.onerror=r.onabort=function(){a.resultMap[e]={result:"no image",success:!1},a.loadingMap[e].loadingFlag=!1,a.loadingMap[e].loadingTime=n.now()-a.loadingMap[e].startTime,a.loadingMap[e].attempts++,i.manager.scheduleRun(0,"imgAjax_error_"+e)}},d.prototype.getCategoryFromFetchId=function(t){return t.replace(/[^a-zA-Z]/g,"")},d.prototype.updateStatistics=function(t,e){e=e||this.getCategoryFromFetchId(t),this.statistics[e]?(this.statistics[e].count++,this.statistics[e].totalTime+=this.resultMap[t].loadingTime,this.statistics[e].lastUpdate=n.now(),delete this.statistics[e].averageTime):this.statistics[e]={count:1,totalTime:this.resultMap[t].loadingTime,lastUpdate:n.now()}},d.prototype.getAverageLoadingTime=function(t){var e=n.now();if(this.statistics[t]&&this.statistics[t].averageTime&&e-this.statistics[t].lastUpdate<500)return this.statistics[t].averageTime;var i=this.statistics[t]?this.statistics[t].totalTime:0,a=this.statistics[t]?this.statistics[t].count:0;return Object.values(this.loadingMap).filter((function(e){return e.category===t})).forEach((function(t){i+=e-t.startTime,a++})),this.statistics[t]?(this.statistics[t].averageTime=a>0?i/a:0,this.statistics[t].lastUpdate=n.now(),this.statistics[t].averageTime):0},g.bracketMap={},g.bracketAllMap={},g.generate=function(t,e){var n,a=g.bracketMap[t.oid],r=Math.max(t.getActualValueLastUpdate("allChildren"),t.getActualValueLastUpdate("width"),t.getActualValueLastUpdate("height"));if(a&&a.lastUpdate>=r)a=g.bracketMap[t.oid];else{a={lastUpdate:r,list:[]};var s=(e="BI"===t.type||e?e:t.getChildren()).length,o=0;for(n=0;n<s&&!e[n].canBeBracketed();n++)o++,a.list.push(e[n]);var l=Math.max(2,i.locationManager.bracketThreshold-1),u=Math.ceil((s-o)/l),h=o;for(n=0;n<u;n++){var c,d=Math.min(s-h,l),p=t.oid+"_"+t.getWidth()+"_"+t.getHeight()+"_"+e.slice(h,h+d).oids("_");g.bracketAllMap[p]?c=g.bracketAllMap[p]:(c=new g(t),g.bracketAllMap[p]=c,c.actualValues.tchildren=e.slice(h,h+d),"BI"===c.actualValues.tchildren[0].type&&c.actualValues.children.forEach((function(t){t.bracketParent=c})),c.bracketParent=t),a.list.push(c),h+=d}a.list.length-o>i.locationManager.bracketThreshold?a=g.generate(t,a.list):g.bracketMap[t.oid]=a}return a},p.prototype.calculateAll=function(){this.hasLocationList.length=0,this.hasLocationMap={},this.locationCount.length=0,i.targetManager.doneTargets.length=0,this.startTime=n.now(),this.calculate(),i.targetManager.doneTargets.length>0&&(i.targetManager.doneTargets.forEach((function(t){t.tmodel.isTargetDone(t.key)&&t.tmodel.setTargetComplete(t.key)})),i.manager.scheduleRun(10,"done to complete"))},p.prototype.calculate=function(){this.addToLocationList(i.ui),this.calculateContainer(i.ui)},p.prototype.getChildren=function(t){var e;return this.isProlificContainer(t)&&(e=g.generate(t)),e?e.list:t.getChildren()},p.prototype.isProlificContainer=function(t){return t.canBeBracketed()&&t.getChildren().length>this.bracketThreshold},p.prototype.calculateContainer=function(t){var e=this.getChildren(t),r=t.createViewport();t.resetVisibleList();for(var s=0;s<e.length&&i.isRunning();){var o,l,u=e[s++];if(this.calculateTargets(u),u.getActualValueLastUpdate("canBeBracketed")>u.getParent().getActualValueLastUpdate("allChildren")&&delete u.getParent().targetValues.allChildren,r.setCurrentChild(u),u.setLocation(r),l=a.isDefined(t.getValue("innerXEast"))?t.getValue("innerXEast"):t.absX+t.getInnerWidth(),o=a.isDefined(u.getValue("outerXEast"))?u.getValue("outerXEast"):u.absX+u.getInnerWidth(),r.isOverflow(o,l)?(r.overflow(),u.setLocation(r)):u.setLocation(r),u.canBeVisible()&&!this.hasLocationMap[u.oid]&&this.addToLocationList(u),u.targetUpdatingMap.x||(a.isDefined(u.targets.x)?i.targetManager.setTargetValue(u,"x"):a.isDefined(u.targetValues.x)||u.setValue("x",u.x)),u.targetUpdatingMap.y||(a.isDefined(u.targets.y)?i.targetManager.setTargetValue(u,"y"):a.isDefined(u.targetValues.y)||u.setValue("y",u.y)),r.isVisible(u),u.addToParentVisibleList(),u.shouldCalculateChildrenLocations()?this.calculateContainer(u):u.manuallyCalculateChildrenLocations(),u.isVisible()&&u.canBeVisible()&&(u.targetUpdatingList.length>0||u.updatingChildren.length>0)&&t.addUpdatingChild(u),u.isInFlow()){var h=u.getHeight();u.hasChildren()&&(i.targetManager.setTargetValuesWithKeys(u,["width","height"],!0),i.targetManager.setJustActualValue(u,"width"),i.targetManager.setJustActualValue(u,"height")),u.getHeight()!==h&&i.events.isScrollTopHandler(u.getParent())&&"up"===i.events.currentTouch.dir&&this.calculateContainer(u),a.isNumber(u.getValue("appendNewLine"))?r.appendNewLine():r.nextLocation()}this.locationCount.push(u.oid+"-"+u.targetUpdatingList.length+"-"+(n.now()-this.startTime))}r.calcContentWidthHeight()},p.prototype.calculateTargets=function(t){i.targetManager.setTargetValues(t),i.targetManager.setActualValues(t),!a.isDefined(t.targetValues.width)&&t.hasDom()&&l.setWidthFromDom(t),!a.isDefined(t.targetValues.height)&&t.hasDom()&&l.setHeightFromDom(t)},p.prototype.addToLocationList=function(t){this.hasLocationList.push(t),this.hasLocationMap[t.oid]=t},f.prototype.openPage=function(t,e){e=!a.isDefined(e)||e,i.stop(),i.reset();var n=this;"function"==typeof i.updateAnalytics&&i.updateAnalytics(t),!this.pageCache[t]&&e?s.ajax({url:t,type:"GET",data:{tpageOnly:!0},success:function(e){i.$dom.outerHTML(e),i.ui=i.uiFactory(),n.lastLink=t,i.start()},error:function(){n.lastLink=void 0,history.back()}}):this.pageCache[t]?(i.$dom.innerHTML(this.pageCache[t].html),i.ui=this.pageCache[t].ui,a.initDoms(this.pageCache[t].visibleList),i.manager.lists.visible=this.pageCache[t].visibleList.slice(0),n.lastLink=t,setTimeout(i.start)):(i.$dom.innerHTML(""),i.ui=i.uiFactory(),n.lastLink=t,setTimeout(i.start))},f.prototype.openLinkFromHistory=function(t){t.link?this.openPage(t.link):t.browserUrl&&(history.replaceState({link:t.browserUrl},"",t.browserUrl),this.openPage(t.browserUrl)),i.manager.scheduleRun(0,"pagemanager-openLinkFromHistory")},f.prototype.openLink=function(t,e){t=a.getFullLink(t),this.lastLink&&(this.pageCache[this.lastLink]={link:this.lastLink,html:i.$dom.innerHTML(),visibleList:i.manager.lists.visible.slice(0),ui:i.ui}),history.pushState({link:t},"",t),this.openPage(t,e),i.manager.scheduleRun(0,"pagemanager-processOpenLink")},f.prototype.updateBrowserUrl=function(t){window.history.state.browserUrl?history.replaceState({browserUrl:t},"",t):(this.pageCache[document.URL]={link:document.URL,html:i.$dom.innerHTML(),visibleList:i.manager.lists.visible.slice(0),ui:i.ui},history.pushState({browserUrl:t},"",t)),i.manager.scheduleRun(0,"pagemanager-processUpdateBrowserUrl")},f.prototype.back=function(){return history.back()},m.prototype.init=function(){this.lists={visible:[],invisibleDom:[],deletedTModel:[],visibleNoDom:[]},this.visibleTypeMap={},this.visibleOidMap={},this.nextRuns=[],this.runningStep=0,this.runningFlag=!1},m.prototype.visibles=function(t,e){return e=e||this.lists.visible,this.lists.visible.filter((function(e){return e.type===t||!t})).map((function(t){return t.oid}))},m.prototype.findVisible=function(t){return this.lists.visible.find((function(e){return e.type===t}))},m.prototype.findLastVisible=function(t){return this.lists.visible.findLast((function(e){return e.type===t}))},m.prototype.analyze=function(){var t,e,n=a.list2map(this.lists.visible);for(this.lists.visible.length=0,this.lists.visibleNoDom.length=0,this.visibleTypeMap={},this.visibleOidMap={},t=0;t<i.locationManager.hasLocationList.length;t++){var r=(e=i.locationManager.hasLocationList[t]).isVisible();e.isMarkedDeleted()&&-1===this.lists.deletedTModel.indexOf(e)?(this.lists.deletedTModel=[].concat(this.lists.deletedTModel,e,e.getAllNestedChildren()),n[e.oid]=null):r&&(n[e.oid]=null,this.lists.visible.push(e),this.visibleOidMap[e.oid]=e,this.visibleTypeMap[e.type]||(this.visibleTypeMap[e.type]=[]),this.visibleTypeMap[e.type].push(e),e.canHaveDom()&&!e.hasDom()&&e.getDomHolder()&&e.getDomHolder().exists()&&-1===this.lists.visibleNoDom.indexOf(e)&&this.lists.visibleNoDom.push(e))}var s=Object.values(n).filter((function(t){return null!==t}));s.forEach((function(t){t.hasDom()&&i.manager.lists.invisibleDom.push(t)}))},m.prototype.renderTModels=function(){var t,e,i=[],n=[];for(this.lists.visible.forEach((function(t){t.hasDom()&&a.isDefined(t.getHtml())&&(t.$dom.html()===t.getHtml()&&t.$dom.textOnly===t.isTextOnly()||i.push(t)),t.hasDom()&&t.hasDomHolderChanged()&&n.push(t)})),t=0;t<i.length;t++)(e=i[t]).isTextOnly()?e.$dom.text(e.getHtml()):e.$dom.html(e.getHtml()),e.setActualValueLastUpdate("html"),e.domHeight=void 0,e.domWidth=void 0;for(t=0;t<n.length;t++)(e=n[t]).$dom.detach(),e.getDomHolder().appendTModel$Dom(e)},m.prototype.deleteDoms=function(){var t;for(t=0;t<this.lists.invisibleDom.length;t++){var e=this.lists.invisibleDom[t];e.domValues={},e.xVisible=!1,e.yVisible=!1,e.invisibleFunctions&&e.invisibleFunctions.forEach((function(t){var i=t.key;t.fn.call(e,i,e.getTargetStep(i),e.getTargetCycle(i),e.getTargetSteps(i),e.getTargetCycles(i))})),e.isDomDeletable()&&(e.$dom.detach(),e.$dom=null)}for(t=0;t<this.lists.deletedTModel.length;t++)this.removeTModel(this.lists.deletedTModel[t]);var i=this.lists.invisibleDom.length>0||this.lists.deletedTModel.length>0;this.lists.invisibleDom.length=0,this.lists.deletedTModel.length=0,i&&this.scheduleRun(0,"deleteDoms")},m.prototype.removeTModel=function(t){t.markAsDeleted();var e,i=t.getParent();i&&i.hasChildren()&&(i.removeUpdatingChild(t),(e=i.getValue("children").indexOf(t))>=0&&(i.getValue("children").splice(e,1),i.setActualValueLastUpdate("children")),(e=i.getValue("addedChildren").indexOf(t))>=0&&(i.getValue("addedChildren").splice(e,1),i.setActualValueLastUpdate("addedChildren")),i.setActualValueLastUpdate("allChildren")),t.$dom&&(t.$dom.detach(),t.$dom=null)},m.prototype.createDoms=function(){var t,e,n,r=[],o=[];for(this.lists.visibleNoDom.sort((function(t,e){return t.hasChildren()&&e.hasChildren()?t.getUIDepth()<e.getUIDepth()?-1:1:t.hasChildren()?-1:1})),t=0;t<this.lists.visibleNoDom.length;t++)n=this.lists.visibleNoDom[t],s.query("#"+n.oid)?(e=new s("#"+n.oid),n.$dom=e):o.push(n);for(t=0;t<o.length;t++){n=o[t];var l=Math.floor(n.getX()),u=Math.floor(n.getY()),h=Math.floor(n.getRotate()),c=a.formatNum(n.getScale(),2),d=Math.floor(n.getWidth()),g=Math.floor(n.getHeight()),p=Math.floor(n.getZIndex()),f={position:"absolute",top:0,left:0,transform:[l,u,h,c],width:d+"px",opacity:n.getOpacity().toFixed(2),height:g+"px",zIndex:p};(e=new s).create("div"),e.setSelector("#"+n.oid),e.setId(n.oid),e.css(n.getCss()),e.setStyleByMap(f),n.domValues={},n.domValues.x=l,n.domValues.y=u,n.domValues.rotate=h,n.domValues.scale=c,n.$dom=e;var m=r.find((function(t){return t.domHolder===n.getDomHolder()}));m?m.tmodels.push(n):r.push({domHolder:n.getDomHolder(),tmodels:[n]})}r.map((function(t){t.tmodels.map((function(e){t.domHolder.appendTModel$Dom(e)}))})),r.length&&i.manager.scheduleRun(1,"createDom")},m.prototype.scheduleRun=function(t,e){if(t<1&&0===i.throttle)i.manager.run(e,t);else{var a=n.delay((function(){i.manager.run(e,t)}),e,0===i.throttle?t||0:i.throttle),r=this.nextRuns.length>0?this.nextRuns[this.nextRuns.length-1]:null;a&&(!r||a.delay>r.delay)&&this.nextRuns.push(a)}},m.prototype.run=function(t,e){i.isRunning()?i.manager.runningFlag?i.manager.scheduleRun(1,t):(i.manager.runningFlag=!0,window.requestAnimationFrame((function(){for(var a=n.now();n.now()-a<25&&i.manager.runningStep<7&&i.isRunning();){switch(i.manager.runningStep){case 0:i.events.captureEvents(),i.locationManager.calculateTargets(i.ui),i.locationManager.calculateAll(),i.events.resetEvents();break;case 1:i.manager.analyze();break;case 2:i.manager.createDoms();break;case 3:i.manager.renderTModels();break;case 4:for(var r=0;r<i.manager.lists.visible.length;r++){var s=i.manager.lists.visible[r];s.hasDom()&&(s.fixXYRotateScale(),s.fixOpacity(),s.fixZIndex(),s.fixCss(),s.fixStyle(),s.fixDim())}break;case 5:i.manager.deleteDoms();break;case 6:i.loader.singleLoad(),i.loader.groupLoad(),i.loader.imgLoad()}i.manager.runningStep++}i.debugLevel>0&&(n.log(i.debugLevel>0&&n.now()-a>10)("it took: "+(n.now()-a)+", "+t),n.log(i.debugLevel>0&&n.now()-a>10)("count: "+i.locationManager.locationCount),n.log(i.debugLevel>1)("request from: "+t+" delay:  "+e)),i.manager.runningFlag=!1,7!==i.manager.runningStep?i.manager.run("rendering: "+i.manager.runningStep):(i.manager.runningStep=0,i.manager.getNextRun())}))):this.getNextRun()},m.prototype.getNextRun=function(){if(this.nextRuns.length>0&&i.isRunning()){var t=this.nextRuns.pop();t&&i.manager.scheduleRun(t.timeStamp-n.now(),t.oid)}},y.prototype.setTargetValuesWithKeys=function(t,e,i){for(var n=0;n<e.length;n++){var a=e[n];t.targetValues[a]&&t.getCallingTargetKey(a)===a&&this.setTargetValue(t,a,i)}},y.prototype.setTargetValues=function(t){var e=Object.keys(t.activeTargetKeyMap);t.targets!==t.actualValues.targets&&(t.actualValues.targets=t.targets,Object.keys(t.targets).forEach((function(t){-1===e.indexOf(t)&&e.push(t)}))),t.targetUpdatingMap={},t.targetUpdatingList=[];for(var i=0;i<e.length;i++){var n=e[i];t.targetUpdatingMap[n]||(t.isTargetUpdating(n)&&t.getCallingTargetKey(n)!==n||this.setTargetValue(t,n)?(t.targetUpdatingMap[n]=!0,t.targetUpdatingList.push(n)):t.isTargetDone(n)&&!t.isTargetComplete(n)&&this.doneTargets.push({tmodel:t,key:n}))}t.getParent()&&0===t.targetUpdatingList.length&&t.getParent().removeUpdatingChild(t)},y.prototype.setTargetValue=function(t,e,n){var r=t.targets[e];if(a.isDefined(r))if(t.isTargetUpdating(e)||!t.targetValues[e]||t.isTargetInLoop(e)||!t.hasTargetGotExecuted(e)||n){if(t.isTargetEnabled(e)){var s=!!r&&!!r.valueOnly;if(!a.isDefined(t.getActualTimeStamp(e))){var o=t.getTargetCycle(e),u=l.getValueStepsCycles(t,r,o,s,e);l.assignValueArray(t,e,u)}if(!t.isTargetInLoop(e)&&t.isTargetDone(e)&&t.isTargetComplete(e)&&!a.isDefined(t.getActualTimeStamp(e))&&t.hasTargetGotExecuted(e)?t.activeTargetKeyMap[e]&&delete t.activeTargetKeyMap[e]:t.activeTargetKeyMap[e]=!0,a.isDefined(t.getActualTimeStamp(e))){var h=l.getActualSchedulePeriod(t,e,t.getTargetStepInterval(e));h>0&&i.manager.scheduleRun(h,"actualInterval__"+t.oid+"__"+e)}return!t.isTargetDone(e)&&!t.isTargetComplete(e)||!t.doesTargetEqualActual(e)}t.activeTargetKeyMap[e]=!0}else t.activeTargetKeyMap[e]&&delete t.activeTargetKeyMap[e];else delete t.activeTargetKeyMap[e]},y.prototype.setActualValues=function(t){var e,n,r=[];for(e=0;e<t.targetUpdatingList.length;e++){n=t.targetUpdatingList[e],t.targets[n];var s=t.getTargetStatus(n);t.isTargetUpdating(n)&&r.push(n),s!==t.getTargetStatus(n)&&i.manager.scheduleRun(1,t.oid+"-"+n+"-statusChange")}for(e=0;e<r.length;e++){n=r[e];var o=l.getActualSchedulePeriod(t,n,t.getTargetStepInterval(n));0!==o&&a.isDefined(o)?i.manager.scheduleRun(o,"actualInterval__"+t.oid+"__"+n):this.setActualValue(t,n)}},y.prototype.setJustActualValue=function(t,e){var i=t.targets[e];if(!t.targetValues[e]||i&&"function"==typeof i.enabledOn&&!i.enabledOn.call(t,e))return!1;var n=t.getTargetValue(e),s=t.getTargetStep(e),o=a.isDefined(t.getTargetEasing(e))?t.getTargetEasing(e):r.linear,l=t.getTargetSteps(e),u=o(t.getTargetStepPercent(e,s));s<l?(a.isDefined(t.getLastActualValue(e))||t.setLastActualValue(e,t.actualValues[e]),t.actualValues[e]="number"==typeof n?n*u+t.getLastActualValue(e)*(1-u):n):t.actualValues[e]=n},y.prototype.setActualValue=function(t,e){if(!t.targetValues[e])return!1;var s=t.getTargetValue(e),o=t.getTargetStep(e),u=t.getTargetSteps(e),h=a.isDefined(t.getTargetEasing(e))?t.getTargetEasing(e):r.linear,c=t.getTargetCycle(e),d=h(t.getTargetStepPercent(e,o)),g=!1,p=t.getTargetStepInterval(e),f=(t.getActualValueLastUpdate(e),t.actualValues[e]),m=o,y=c;n.now(),o<u&&(a.isDefined(t.getLastActualValue(e))||t.setLastActualValue(e,t.actualValues[e]),t.actualValues[e]="number"==typeof s?s*d+t.getLastActualValue(e)*(1-d):s,t.setActualValueLastUpdate(e),t.setActualValueLastUpdate(e),a.isDefined(p),o=t.setTargetStep(e,o+1)),o>=u&&(t.actualValues[e]=s,t.setActualValueLastUpdate(e),"object"==typeof t.targets[e]&&"function"==typeof t.targets[e].onStepsEnd&&t.targets[e].onStepsEnd.call(t,e,c),t.updateTargetStatus(e),t.getTargetCycle(e)<t.getTargetCycles(e)&&(t.setTargetCycle(e,t.getTargetCycle(e)+1),g=!0,t.resetTargetStep(e),t.resetLastActualValue(e))),l.handleValueChange(t,e,t.actualValues[e],f,m,y),a.isDefined(t.getActualTimeStamp(e))&&t.resetActualTimeStamp(e),(o<u||g)&&i.manager.scheduleRun(o<u?p:0,t.oid+"---"+e+"-"+o+"/"+u+"-"+c+"-"+p)},window.t=window.t||o.find,v.oids={},v.getOid=function(t){a.isDefined(v.oids[t])||(v.oids[t]=0);var e=v.oids[t]++;return{oid:e>0?t+e:t,num:e}},window.TargetJ=e})();